<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Reading Feedback</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
.correct { color: green; font-weight: bold; }
.close { color: orange; font-weight: bold; }
.wrong { color: red; font-weight: bold; }
</style>
</head>
<body>

<h3>Read this sentence:</h3>
<p id="model">I like studying geography at school.</p>

<textarea id="speechInput" rows="3" cols="40"
  placeholder="Tap here, then tap the mic and read the sentence"></textarea>

<br><br>
<button id="stopBtn">ðŸ›‘ Stop Listening</button>

<h3>Your result:</h3>
<div id="feedback"></div>

<script>
const modelEl = document.getElementById("model");
const input = document.getElementById("speechInput");
const feedback = document.getElementById("feedback");
const stopBtn = document.getElementById("stopBtn");

// clean text: lowercase + remove punctuation
function clean(text) {
  return text
    .toLowerCase()
    .replace(/[.,!?]/g, "")
    .trim();
}

stopBtn.addEventListener("click", () => {
  input.blur(); // stop dictation
  checkAnswer();
});

function checkAnswer() {
  const modelText = modelEl.textContent;
  const spokenText = input.value;

  if (!spokenText) return;

  const modelWords = clean(modelText).split(" ");
  const spokenWords = clean(spokenText).split(" ");

  let resultHTML = "";

  modelWords.forEach((word, i) => {
    if (spokenWords.includes(word)) {
      resultHTML += `<span class="close">${modelText.split(" ")[i]} </span>`;
    } else {
      resultHTML += `<span class="wrong">${modelText.split(" ")[i]} </span>`;
    }
  });

  // perfect match â†’ all green
  if (clean(spokenText) === clean(modelText)) {
    resultHTML = modelText
      .split(" ")
      .map(w => `<span class="correct">${w} </span>`)
      .join("");
  }

  feedback.innerHTML = resultHTML;
}
</script>

</body>
</html>
