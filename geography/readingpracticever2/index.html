<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Social Studies Speaking Lab</title>
    <style>
        :root {
            --primary: #2c3e50;
            --accent: #3498db;
            --success: #27ae60;
            --bg: #f4f7f6;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg);
            display: flex;
            justify-content: center;
            padding: 20px;
            color: var(--primary);
        }

        .container {
            background: white;
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            max-width: 600px;
            width: 100%;
            text-align: center;
        }

        h1 { margin-bottom: 0.5rem; color: var(--primary); }
        p.subtitle { color: #7f8c8d; margin-bottom: 2rem; }

        #text-container {
            font-size: 1.4rem;
            line-height: 1.6;
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: #fdfdfd;
            border: 1px solid #eee;
            border-radius: 10px;
        }

        .word { display: inline-block; margin-right: 5px; transition: color 0.3s; }
        .correct { color: var(--success); font-weight: bold; }

        .controls { display: flex; gap: 10px; justify-content: center; margin-bottom: 1.5rem; }

        button {
            padding: 12px 24px;
            font-size: 1rem;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: opacity 0.2s;
        }

        #listen-btn { background-color: #95a5a6; color: white; }
        #start-btn { background-color: var(--accent); color: white; }
        button:disabled { opacity: 0.5; cursor: not-allowed; }

        #feedback {
            margin-top: 1rem;
            font-weight: bold;
            font-size: 1.2rem;
        }

        .score-circle {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            border: 5px solid var(--accent);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 1rem auto;
            font-size: 1.2rem;
            font-weight: bold;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>Speaking Lab</h1>
    <p class="subtitle">Social Studies: Human Rights & Democracy</p>

    <div id="text-container">
        </div>

    <div class="controls">
        <button id="listen-btn">ðŸ”ˆ Hear Model</button>
        <button id="start-btn">ðŸŽ¤ Start Speaking</button>
    </div>

    <div id="score-display" class="score-circle">--%</div>
    <p id="feedback">Press the blue button and read clearly.</p>
</div>

<script>
    // 1. Configuration
    const targetPhrase = "All human beings are born free and equal in dignity and rights.";
    const textContainer = document.getElementById('text-container');
    const startBtn = document.getElementById('start-btn');
    const listenBtn = document.getElementById('listen-btn');
    const scoreDisplay = document.getElementById('score-display');
    const feedback = document.getElementById('feedback');

    // 2. Setup Display
    const words = targetPhrase.split(" ");
    textContainer.innerHTML = words.map(w => `<span class="word">${w}</span>`).join("");
    const wordSpans = document.querySelectorAll('.word');

    // 3. Speech Recognition Setup
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    
    if (!SpeechRecognition) {
        feedback.innerText = "Error: Your browser does not support Speech Recognition. Please use Chrome.";
    } else {
        const recognition = new SpeechRecognition();
        recognition.lang = 'en-US';
        recognition.interimResults = false;

        // 4. Listen to Model (Text-to-Speech)
        listenBtn.onclick = () => {
            const utterance = new SpeechSynthesisUtterance(targetPhrase);
            utterance.lang = 'en-US';
            utterance.rate = 0.9; // Slightly slower for students
            window.speechSynthesis.speak(utterance);
        };

        // 5. Reading Logic
        startBtn.onclick = () => {
            recognition.start();
            startBtn.disabled = true;
            feedback.innerText = "Listening... read now!";
            // Reset colors
            wordSpans.forEach(span => span.classList.remove('correct'));
        };

        recognition.onresult = (event) => {
            const transcript = event.results[0][0].transcript.toLowerCase();
            const spokenWords = transcript.replace(/[.,/#!$%^&*;:{}=\-_`~()]/g,"").split(" ");
            
            let matchCount = 0;

            words.forEach((word, index) => {
                const cleanWord = word.toLowerCase().replace(/[.,/#!$%^&*;:{}=\-_`~()]/g,"");
                if (spokenWords.includes(cleanWord)) {
                    wordSpans[index].classList.add('correct');
                    matchCount++;
                }
            });

            const finalScore = Math.round((matchCount / words.length) * 100);
            scoreDisplay.innerText = finalScore + "%";
            feedback.innerText = `I heard: "${transcript}"`;
            startBtn.disabled = false;
        };

        recognition.onerror = () => {
            feedback.innerText = "Try again! Make sure your mic is on.";
            startBtn.disabled = false;
        };
    }
</script>

</body>
</html>