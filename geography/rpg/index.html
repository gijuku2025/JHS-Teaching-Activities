<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Knowledge Knight - Combat Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
        
        body {
            background-color: #020617;
            color: #f8fafc;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow: hidden;
        }

        .game-container {
            max-width: 850px;
            margin: 20px auto;
            background: #0f172a;
            border: 4px solid #1e293b;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 0 60px rgba(0,0,0,0.8);
        }

        /* Health Bar Overhaul */
        .health-bar {
            height: 16px;
            background: #020617;
            border-radius: 4px;
            overflow: hidden;
            border: 2px solid #334155;
            position: relative;
        }

        .hp-fill {
            height: 100%;
            background: linear-gradient(90deg, #dc2626, #ef4444);
            box-shadow: 0 0 10px rgba(239, 68, 68, 0.5);
            transition: width 0.3s ease-out;
        }

        .enemy-hp-fill {
            height: 100%;
            background: linear-gradient(90deg, #7c3aed, #a855f7);
            box-shadow: 0 0 10px rgba(168, 85, 247, 0.5);
            transition: width 0.3s ease-out;
        }

        /* Combat Visuals */
        .stage-bg {
            background: linear-gradient(180deg, #1e293b 0%, #0f172a 100%);
            background-image: 
                radial-gradient(circle at 20% 30%, rgba(51, 65, 85, 0.4) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(30, 41, 59, 0.4) 0%, transparent 50%);
        }

        .slash-effect {
            position: absolute;
            font-size: 5rem;
            z-index: 40;
            pointer-events: none;
            filter: drop-shadow(0 0 10px white);
            opacity: 0;
        }

        .knight-slash { animation: slashRight 0.4s ease-out forwards; }
        .monster-slash { animation: slashLeft 0.4s ease-out forwards; }

        @keyframes slashRight {
            0% { transform: translate(-50px, 0) rotate(-45deg); opacity: 0; }
            50% { transform: translate(150px, 0) rotate(45deg); opacity: 1; }
            100% { transform: translate(250px, 50px) rotate(90deg); opacity: 0; }
        }

        @keyframes slashLeft {
            0% { transform: translate(50px, 0) rotate(45deg) scaleX(-1); opacity: 0; }
            50% { transform: translate(-150px, 0) rotate(-45deg) scaleX(-1); opacity: 1; }
            100% { transform: translate(-250px, 50px) rotate(-90deg) scaleX(-1); opacity: 0; }
        }

        .knight-attack { animation: knightLunge 0.5s cubic-bezier(.47,0,.74,.71); }
        .monster-attack { animation: monsterLunge 0.5s cubic-bezier(.47,0,.74,.71); }

        @keyframes knightLunge {
            0% { transform: translateX(0); }
            30% { transform: translateX(200px) scale(1.1); }
            100% { transform: translateX(0); }
        }

        @keyframes monsterLunge {
            0% { transform: translateX(0); }
            30% { transform: translateX(-200px) scale(1.1); }
            100% { transform: translateX(0); }
        }

        .screen-shake { animation: shake 0.3s infinite; }
        @keyframes shake {
            0% { transform: translate(2px, 1px) rotate(0deg); }
            20% { transform: translate(-3px, -2px) rotate(-1deg); }
            40% { transform: translate(-1px, 2px) rotate(1deg); }
            60% { transform: translate(3px, 1px) rotate(0deg); }
            80% { transform: translate(-1px, -1px) rotate(1deg); }
            100% { transform: translate(2px, -2px) rotate(-1deg); }
        }

        .damage-number {
            position: absolute;
            font-family: 'Press Start 2P', cursive;
            font-size: 1.5rem;
            pointer-events: none;
            animation: floatDamage 0.8s ease-out forwards;
            z-index: 100;
        }

        @keyframes floatDamage {
            0% { transform: translateY(0); opacity: 1; }
            100% { transform: translateY(-100px) scale(1.5); opacity: 0; }
        }

        .choice-btn {
            background: #1e293b;
            border: 2px solid #334155;
            transition: all 0.15s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .choice-btn:hover:not(:disabled) {
            background: #334155;
            border-color: #6366f1;
            box-shadow: 0 0 15px rgba(99, 102, 241, 0.3);
            transform: scale(1.02);
        }

        .choice-btn:active { transform: scale(0.98); }
        
        .sword-icon {
            position: absolute;
            right: -20px;
            bottom: -20px;
            font-size: 3rem;
            opacity: 0.1;
            transform: rotate(-45deg);
        }
    </style>
</head>
<body class="p-4 flex items-center justify-center min-h-screen">

    <div class="game-container w-full" id="game-viewport">
        <!-- Battle HUD -->
        <div class="p-6 flex justify-between items-start bg-slate-950/80">
            <div class="w-2/5">
                <div class="flex items-center gap-2 mb-2">
                    <span class="text-2xl">üõ°Ô∏è</span>
                    <div>
                        <p class="text-[10px] font-black tracking-widest text-blue-400">KNIGHT RADIANT</p>
                        <p id="player-hp-text" class="text-sm font-bold font-mono">100 / 100</p>
                    </div>
                </div>
                <div class="health-bar"><div id="player-hp" class="hp-fill"></div></div>
            </div>
            
            <div class="text-center">
                <div class="bg-slate-800 px-3 py-1 rounded border border-slate-600">
                    <span id="room-counter" class="text-xs font-black text-yellow-500 uppercase">Battle 1</span>
                </div>
            </div>

            <div class="w-2/5 text-right">
                <div class="flex items-center justify-end gap-2 mb-2">
                    <div>
                        <p class="text-[10px] font-black tracking-widest text-purple-400">DUNGEON CREATURE</p>
                        <p id="enemy-hp-text" class="text-sm font-bold font-mono text-right">100 / 100</p>
                    </div>
                    <span id="enemy-mini-icon" class="text-2xl">üëæ</span>
                </div>
                <div class="health-bar"><div id="enemy-hp" class="enemy-hp-fill"></div></div>
            </div>
        </div>

        <!-- Battlefield -->
        <div id="battle-stage" class="relative h-80 stage-bg flex items-center justify-around overflow-hidden border-y-4 border-slate-950">
            <!-- Combat FX Layer -->
            <div id="fx-layer" class="absolute inset-0 pointer-events-none"></div>

            <!-- Entities -->
            <div id="player-sprite" class="relative text-8xl z-20 transition-all duration-300">
                üõ°Ô∏è
            </div>
            
            <div id="enemy-sprite" class="relative text-9xl z-20 transition-all duration-300">
                üëæ
            </div>
        </div>

        <!-- Interaction UI -->
        <div class="p-8 bg-slate-900">
            <div class="mb-8 min-h-[60px] flex items-center justify-center">
                <h2 id="question-text" class="text-xl md:text-2xl font-bold text-center text-white drop-shadow-md">
                    Waiting for encounter...
                </h2>
            </div>

            <div id="choices-container" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <!-- Choices -->
            </div>
        </div>
    </div>

    <!-- Victory/Defeat Overlay -->
    <div id="end-screen" class="hidden fixed inset-0 bg-black/95 flex items-center justify-center p-8 z-50">
        <div class="text-center">
            <div id="end-icon" class="text-9xl mb-8 animate-bounce">üèÜ</div>
            <h1 id="end-title" class="text-6xl font-black mb-4 italic tracking-tighter uppercase">Victory</h1>
            <p id="end-msg" class="text-slate-400 text-xl mb-10">You have conquered the darkness.</p>
            <button onclick="location.reload()" class="bg-white text-black px-12 py-4 rounded-full font-black text-xl hover:bg-yellow-400 transition-all transform hover:scale-110 active:scale-95">
                REBORN
            </button>
        </div>
    </div>

    <script>
        const questData = [
            { q: "What is the primary source of energy for Earth?", a: ["The Moon", "The Sun", "Volcanoes", "Electricity"], correct: 1 },
            { q: "Which element does 'O' represent in the periodic table?", a: ["Gold", "Oxygen", "Iron", "Silver"], correct: 1 },
            { q: "Who is the author of 'The Great Gatsby'?", a: ["F. Scott Fitzgerald", "Ernest Hemingway", "J.K. Rowling", "Charles Dickens"], correct: 0 },
            { q: "What is the value of Pi (to 2 decimal places)?", a: ["3.12", "3.14", "3.16", "3.18"], correct: 1 },
            { q: "Which continent is the Sahara Desert located in?", a: ["Asia", "South America", "Africa", "Australia"], correct: 2 },
            { q: "How many strings does a standard violin have?", a: ["3", "4", "5", "6"], correct: 1 },
            { q: "What is the capital of France?", a: ["Berlin", "London", "Madrid", "Paris"], correct: 3 },
            { q: "Which animal is known as the 'Ship of the Desert'?", a: ["Horse", "Elephant", "Camel", "Donkey"], correct: 2 },
            { q: "What is the largest organ in the human body?", a: ["Heart", "Brain", "Liver", "Skin"], correct: 3 },
            { q: "Who discovered gravity when an apple fell on his head?", a: ["Einstein", "Newton", "Tesla", "Galileo"], correct: 1 }
        ];

        let currentRoom = 0;
        let playerHP = 100;
        let enemyHP = 100;
        let isBusy = false;

        const monsterIcons = ["üëæ", "üëπ", "üíÄ", "ü¶Ç", "üêâ", "üßõ", "üßü", "üêç", "ü¶ç", "üî•"];

        function updateHUD() {
            document.getElementById('player-hp').style.width = playerHP + '%';
            document.getElementById('player-hp-text').innerText = `${playerHP} / 100`;
            document.getElementById('enemy-hp').style.width = Math.max(0, enemyHP) + '%';
            document.getElementById('enemy-hp-text').innerText = `${Math.max(0, enemyHP)} / 100`;
        }

        function createSlash(isPlayer) {
            const slash = document.createElement('div');
            slash.className = `slash-effect ${isPlayer ? 'knight-slash' : 'monster-slash'}`;
            slash.innerText = isPlayer ? "‚öîÔ∏è" : "üîÆ";
            slash.style.left = isPlayer ? "40%" : "60%";
            slash.style.top = "40%";
            document.getElementById('fx-layer').appendChild(slash);
            setTimeout(() => slash.remove(), 500);
        }

        function spawnDamage(amount, isPlayerTarget) {
            const target = isPlayerTarget ? document.getElementById('player-sprite') : document.getElementById('enemy-sprite');
            const num = document.createElement('div');
            num.className = `damage-number ${isPlayerTarget ? 'text-red-500' : 'text-yellow-400'}`;
            num.innerText = `-${amount}`;
            num.style.left = (target.offsetLeft + 50) + 'px';
            num.style.top = (target.offsetTop) + 'px';
            document.getElementById('fx-layer').appendChild(num);
            setTimeout(() => num.remove(), 800);
        }

        function initRoom() {
            if (currentRoom >= questData.length) {
                showEndScreen(true);
                return;
            }

            isBusy = false;
            const data = questData[currentRoom];
            document.getElementById('room-counter').innerText = `Battle ${currentRoom + 1}`;
            document.getElementById('question-text').innerText = data.q;
            document.getElementById('enemy-sprite').innerText = monsterIcons[currentRoom % monsterIcons.length];
            document.getElementById('enemy-mini-icon').innerText = monsterIcons[currentRoom % monsterIcons.length];
            
            const container = document.getElementById('choices-container');
            container.innerHTML = '';
            
            data.a.forEach((choice, index) => {
                const btn = document.createElement('button');
                btn.className = "choice-btn p-5 rounded-xl text-left font-bold text-slate-300";
                btn.innerHTML = `<span>${choice}</span><span class="sword-icon">‚öîÔ∏è</span>`;
                btn.onclick = () => handleAttack(index);
                container.appendChild(btn);
            });

            if (currentRoom % 2 === 0 && currentRoom !== 0) {
                enemyHP = 100;
                updateHUD();
            }
        }

        async function handleAttack(index) {
            if (isBusy) return;
            isBusy = true;

            const buttons = document.querySelectorAll('.choice-btn');
            buttons.forEach(b => b.disabled = true);

            const isCorrect = index === questData[currentRoom].correct;
            const player = document.getElementById('player-sprite');
            const enemy = document.getElementById('enemy-sprite');
            const viewport = document.getElementById('game-viewport');

            if (isCorrect) {
                // KNIGHT STRIKES
                player.classList.add('knight-attack');
                await new Promise(r => setTimeout(r, 150));
                
                createSlash(true);
                enemyHP -= 34;
                spawnDamage(34, false);
                viewport.classList.add('screen-shake');
                
                await new Promise(r => setTimeout(r, 350));
                viewport.classList.remove('screen-shake');
                player.classList.remove('knight-attack');
            } else {
                // MONSTER STRIKES
                enemy.classList.add('monster-attack');
                await new Promise(r => setTimeout(r, 150));
                
                createSlash(false);
                playerHP -= 25;
                spawnDamage(25, true);
                viewport.classList.add('screen-shake');
                
                await new Promise(r => setTimeout(r, 350));
                viewport.classList.remove('screen-shake');
                enemy.classList.remove('monster-attack');
            }

            updateHUD();

            if (playerHP <= 0) {
                setTimeout(() => showEndScreen(false), 400);
                return;
            }

            setTimeout(() => {
                currentRoom++;
                initRoom();
            }, 500);
        }

        function showEndScreen(win) {
            const screen = document.getElementById('end-screen');
            screen.classList.remove('hidden');
            document.getElementById('end-icon').innerText = win ? "üèÜ" : "üíÄ";
            document.getElementById('end-title').innerText = win ? "Conquered" : "Fallen";
            document.getElementById('end-title').className = win ? "text-6xl font-black mb-4 text-yellow-500 uppercase italic" : "text-6xl font-black mb-4 text-red-600 uppercase italic";
            document.getElementById('end-msg').innerText = win 
                ? "The dungeon lies silent. You are the Champion of Knowledge." 
                : "Darkness consumes the knight. Your quest ends here.";
        }

        window.onload = () => {
            updateHUD();
            initRoom();
        };
    </script>
</body>
</html>