<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Kanji Matching Drill</title>

<style>
  body {
    font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
    margin: 0;
    padding: 16px;
    background: #f5f5f5;
  }

  h2 {
    margin-top: 0;
  }

  button {
    padding: 8px 14px;
    font-size: 16px;
    margin: 6px 6px 6px 0;
    cursor: pointer;
  }

  .controls {
    margin-bottom: 14px;
  }

  .kanji-container,
  .reading-container {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(64px, 1fr));
    gap: 8px;
  }

  .reading-container {
    margin-top: 18px;
  }

  .kanji-tile,
  .reading-tile {
    height: 64px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 10px;
    background: white;
    border: 2px solid #ccc;
    user-select: none;
    touch-action: manipulation;
  }

  .kanji-tile {
    font-size: 28px;
  }

  .reading-tile {
    font-size: 20px;
    padding: 6px;
    text-align: center;
    line-height: 1.2;
    position: relative;
  }

  .kanji-tile.active {
    background: #ffe08a;
    border-color: #f2b600;
  }

  .kanji-tile.matched {
    background: #b9f6ca;
    border-color: #2e7d32;
  }

  .overlay-kanji {
    position: absolute;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 28px;
    background: #b9f6ca;
    border-radius: 8px;
    border: 2px solid #2e7d32;
  }
</style>
</head>

<body>

<h2>Kanji Matching Drill</h2>

<div class="controls">
  <strong>Select JLPT level:</strong><br />
  <label><input type="checkbox" value="N5" checked> N5</label>
  <label><input type="checkbox" value="N4"> N4</label>
  <label><input type="checkbox" value="N3"> N3</label>
  <br />
  <button onclick="startDrill()">Start</button>
</div>

<div id="kanjiContainer" class="kanji-container"></div>
<div id="readingContainer" class="reading-container"></div>

<script>
/* =========================
   KANJI DATA (sample – expandable)
   ========================= */

const JLPT = {
  N5: [
    { k: '一', on: ['イチ'], kun: ['ひと'] },
    { k: '二', on: ['ニ'], kun: ['ふた'] },
    { k: '三', on: ['サン'], kun: ['み'] },
    { k: '四', on: ['ヨン'], kun: ['よ'] },
    { k: '五', on: ['ゴ'], kun: ['いつ'] },
    { k: '六', on: ['ロク'], kun: ['む'] },
    { k: '七', on: ['ナナ'], kun: ['なな'] },
    { k: '八', on: ['ハチ'], kun: ['や'] },
    { k: '九', on: ['キュウ'], kun: ['ここの'] },
    { k: '十', on: ['ジュウ'], kun: ['とお'] }
  ],
  N4: [],
  N3: []
};

/* =========================
   STATE
   ========================= */

let activeKanjiTile = null;
let currentChunk = [];

/* =========================
   START DRILL
   ========================= */

function startDrill() {
  activeKanjiTile = null;

  const selectedLevels = [...document.querySelectorAll('input[type=checkbox]:checked')]
    .map(cb => cb.value);

  let pool = [];
  selectedLevels.forEach(level => pool = pool.concat(JLPT[level]));

  currentChunk = pool.slice(0, 10);

  renderKanji();
  renderReadings();
}

/* =========================
   RENDER KANJI
   ========================= */

function renderKanji() {
  const container = document.getElementById('kanjiContainer');
  container.innerHTML = '';

  currentChunk.forEach(obj => container.appendChild(createKanjiTile(obj)));
}

/* =========================
   RENDER READINGS
   ========================= */

function renderReadings() {
  const container = document.getElementById('readingContainer');
  container.innerHTML = '';

  const shuffled = [...currentChunk].sort(() => Math.random() - 0.5);
  shuffled.forEach(obj => container.appendChild(createReadingTile(obj)));
}

/* =========================
   KANJI TILE
   ========================= */

function createKanjiTile(obj) {
  const tile = document.createElement('div');
  tile.className = 'kanji-tile';
  tile.textContent = obj.k;
  tile.dataset.kanji = obj.k;

  const select = (e) => {
    e.preventDefault();

    if (activeKanjiTile === tile) {
      tile.classList.remove('active');
      activeKanjiTile = null;
      return;
    }

    if (activeKanjiTile) activeKanjiTile.classList.remove('active');

    tile.classList.add('active');
    activeKanjiTile = tile;
  };

  tile.addEventListener('click', select);
  tile.addEventListener('touchstart', select, { passive: false });

  return tile;
}

/* =========================
   READING TILE
   ========================= */

function createReadingTile(obj) {
  const tile = document.createElement('div');
  tile.className = 'reading-tile';
  tile.dataset.kanji = obj.k;

  tile.textContent = [...obj.on, ...obj.kun].join(', ');

  tile.addEventListener('click', () => attemptMatch(tile));
  tile.addEventListener('touchstart', (e) => {
    e.preventDefault();
    attemptMatch(tile);
  }, { passive: false });

  return tile;
}

/* =========================
   MATCH LOGIC (OVERWRITE)
   ========================= */

function attemptMatch(readingTile) {
  if (!activeKanjiTile) return;

  if (activeKanjiTile.dataset.kanji === readingTile.dataset.kanji) {
    const overlay = document.createElement('div');
    overlay.className = 'overlay-kanji';
    overlay.textContent = activeKanjiTile.dataset.kanji;

    readingTile.innerHTML = '';
    readingTile.appendChild(overlay);

    activeKanjiTile.classList.remove('active');
    activeKanjiTile.classList.add('matched');
    activeKanjiTile = null;
  }
}
</script>

</body>
</html>
