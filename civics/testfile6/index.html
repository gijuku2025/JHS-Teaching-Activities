<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Kanji Matching Drill</title>

<style>
  body {
    font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
    margin: 0;
    padding: 16px;
    background: #f5f5f5;
  }

  h2 {
    margin-top: 0;
  }

  button {
    padding: 8px 14px;
    font-size: 16px;
    margin-right: 6px;
    cursor: pointer;
  }

  .controls {
    margin-bottom: 12px;
  }

  .kanji-container,
  .reading-container {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(64px, 1fr));
    gap: 8px;
    margin-bottom: 14px;
  }

  .reading-container {
    margin-top: 18px; /* gap between kanji + readings */
  }

  .kanji-tile,
  .reading-tile {
    height: 64px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 10px;
    background: white;
    border: 2px solid #ccc;
    font-size: 28px;
    user-select: none;
    touch-action: manipulation;
  }

  .reading-tile {
    font-size: 18px;
    padding: 6px;
    text-align: center;
    line-height: 1.2;
  }

  .kanji-tile.active {
    background: #ffe08a;
    border-color: #f2b600;
  }

  .reading-tile.correct {
    visibility: hidden;
  }

  .kanji-tile.matched {
    background: #b9f6ca;
    border-color: #2e7d32;
  }
</style>
</head>

<body>

<h2>Kanji Matching Drill</h2>

<div class="controls">
  <button onclick="startDrill()">Start</button>
</div>

<div id="kanjiContainer" class="kanji-container"></div>
<div id="readingContainer" class="reading-container"></div>

<script>
/* =========================
   KANJI LIST (N5 SAMPLE)
   ========================= */

const kanjiList = [
  { k: '一', on: ['イチ'], kun: ['ひと'] },
  { k: '二', on: ['ニ'], kun: ['ふた'] },
  { k: '三', on: ['サン'], kun: ['み'] },
  { k: '四', on: ['ヨン'], kun: ['よ'] },
  { k: '五', on: ['ゴ'], kun: ['いつ'] },
  { k: '六', on: ['ロク'], kun: ['む'] },
  { k: '七', on: ['ナナ'], kun: ['なな'] },
  { k: '八', on: ['ハチ'], kun: ['や'] },
  { k: '九', on: ['キュウ'], kun: ['ここの'] },
  { k: '十', on: ['ジュウ'], kun: ['とお'] },
];

/* =========================
   STATE
   ========================= */

let activeKanjiTile = null;
let currentChunk = [];

/* =========================
   START DRILL
   ========================= */

function startDrill() {
  activeKanjiTile = null;
  currentChunk = kanjiList.slice(0, 10);
  renderKanji();
  renderReadings();
}

/* =========================
   RENDER KANJI
   ========================= */

function renderKanji() {
  const container = document.getElementById('kanjiContainer');
  container.innerHTML = '';

  currentChunk.forEach(obj => {
    container.appendChild(createKanjiTile(obj));
  });
}

/* =========================
   RENDER READINGS
   ========================= */

function renderReadings() {
  const container = document.getElementById('readingContainer');
  container.innerHTML = '';

  const shuffled = [...currentChunk].sort(() => Math.random() - 0.5);

  shuffled.forEach(obj => {
    container.appendChild(createReadingTile(obj));
  });
}

/* =========================
   KANJI TILE
   ========================= */

function createKanjiTile(kanjiObj) {
  const tile = document.createElement('div');
  tile.className = 'kanji-tile';
  tile.textContent = kanjiObj.k;
  tile.dataset.kanji = kanjiObj.k;

  const select = (e) => {
    e.preventDefault();

    if (activeKanjiTile === tile) {
      tile.classList.remove('active');
      activeKanjiTile = null;
      return;
    }

    if (activeKanjiTile) {
      activeKanjiTile.classList.remove('active');
    }

    tile.classList.add('active');
    activeKanjiTile = tile;
  };

  tile.addEventListener('click', select);
  tile.addEventListener('touchstart', select, { passive: false });

  return tile;
}

/* =========================
   READING TILE
   ========================= */

function createReadingTile(kanjiObj) {
  const tile = document.createElement('div');
  tile.className = 'reading-tile';

  const readings = [...kanjiObj.on, ...kanjiObj.kun];
  tile.textContent = readings.join(', ');
  tile.dataset.kanji = kanjiObj.k;

  tile.addEventListener('click', () => attemptMatch(tile));
  tile.addEventListener('touchstart', (e) => {
    e.preventDefault();
    attemptMatch(tile);
  }, { passive: false });

  return tile;
}

/* =========================
   MATCH LOGIC
   ========================= */

function attemptMatch(readingTile) {
  if (!activeKanjiTile) return;

  if (activeKanjiTile.dataset.kanji === readingTile.dataset.kanji) {
    readingTile.classList.add('correct');
    activeKanjiTile.classList.remove('active');
    activeKanjiTile.classList.add('matched');
    activeKanjiTile = null;
  }
}
</script>

</body>
</html>
