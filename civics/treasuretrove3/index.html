<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>3 Minute Challenge</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.tailwindcss.com"></script>
<style>
@import url('https://fonts.googleapis.com/css2?family=Bungee&family=Inter:wght@400;700&display=swap');

body {
    font-family: 'Inter', sans-serif;
    background-color: #46178f;
    color: white;
    margin: 0;
    height: 100vh;
    overflow: hidden;
    touch-action: none;
}

.heading-font { font-family: 'Bungee', cursive; }

.gem {
    position: absolute;
    font-size: 3rem;
    cursor: pointer;
    padding: 85px;
    margin: -85px;
    user-select: none;
}

.tap-effect {
    position: absolute;
    pointer-events: none;
    animation: burst 0.5s ease-out forwards;
    font-size: 2rem;
    font-weight: bold;
}

@keyframes burst {
    0% { transform: scale(1); opacity: 1; }
    100% { transform: scale(2) translateY(-20px); opacity: 0; }
}

.star { font-size: 2rem; }
</style>
</head>
<body class="flex items-center justify-center">

<div id="top-bar" class="fixed top-0 left-0 w-full p-4 flex justify-between items-center bg-black/20 z-40 hidden">
    <div>
        <div id="star-bar">â˜†â˜†â˜†</div>
        <div id="score-display" class="text-2xl heading-font text-yellow-400">$0</div>
    </div>
    <div id="global-timer" class="heading-font text-xl">3:00</div>
</div>

<!-- Nickname Screen -->
<div id="screen-name" class="text-center">
    <h1 class="text-6xl heading-font mb-4 text-yellow-400">3 Minute Challenge</h1>
    <input id="nickname-input" placeholder="Enter nickname" class="p-3 rounded text-black text-xl mb-4"><br>
    <button onclick="startGame()" class="bg-yellow-500 px-8 py-3 rounded text-xl font-bold">Start</button>
</div>

<!-- Quiz Screen -->
<div id="screen-quiz" class="hidden w-full max-w-xl px-6">
    <div class="bg-white text-black p-6 rounded-xl">
        <div id="question-text" class="text-xl font-bold mb-4"></div>
        <div id="options-grid" class="grid grid-cols-1 gap-3"></div>
    </div>
</div>

<!-- Collection Screen -->
<div id="screen-collection" class="hidden fixed inset-0 bg-purple-900">
    <div id="gem-container" class="relative w-full h-full"></div>
</div>

<!-- Results -->
<div id="screen-results" class="hidden text-center">
    <h2 class="text-4xl heading-font mb-4">Vault Closed</h2>
    <div id="final-name" class="text-2xl"></div>
    <div id="final-score" class="text-6xl heading-font text-yellow-400"></div>
    <button onclick="location.reload()" class="bg-white text-purple-900 px-6 py-3 rounded mt-4">Play Again</button>
</div>

<script>
const questions = [
 {q:"Capital of France?",a:["Paris","Rome","Berlin","London"],c:0},
 {q:"Red planet?",a:["Venus","Mars","Jupiter","Saturn"],c:1},
 {q:"5+7?",a:["10","11","12","13"],c:2},
 {q:"Largest ocean?",a:["Atlantic","Indian","Arctic","Pacific"],c:3},
 {q:"Mona Lisa painter?",a:["Van Gogh","Da Vinci","Picasso","Monet"],c:1}
];

const gems = ["ðŸ’Ž","ðŸ‘‘","ðŸ’°","âœ¨","ðŸª™"];
const trash = ["ðŸ‘ž","ðŸŒ","ðŸ¥«","ðŸ¦´"];

let nickname="";
let score=0;
let streak=0;
let mercy=0;
let qIndex=0;
let gameOver=false;
let timeLeft=180;

const screens={
 name:screen("screen-name"),
 quiz:screen("screen-quiz"),
 collect:screen("screen-collection"),
 results:screen("screen-results")
};

function screen(id){return document.getElementById(id)}

function show(s){
 Object.values(screens).forEach(x=>x.classList.add("hidden"));
 screens[s].classList.remove("hidden");
}

function startGame(){
 nickname=document.getElementById("nickname-input").value.trim();
 if(!nickname) return alert("Nickname required");
 show("quiz");
 document.getElementById("top-bar").classList.remove("hidden");
 startTimer();
 loadQuestion();
}

function startTimer(){
 const t=document.getElementById("global-timer");
 const timer=setInterval(()=>{
  if(gameOver) return clearInterval(timer);
  timeLeft--;
  t.innerText=`${Math.floor(timeLeft/60)}:${String(timeLeft%60).padStart(2,"0")}`;
  if(timeLeft<=0 && screens.collect.classList.contains("hidden")) endGame();
 },1000);
}

function loadQuestion(){
 const q=questions[qIndex%questions.length];
 document.getElementById("question-text").innerText=q.q;
 const grid=document.getElementById("options-grid");
 grid.innerHTML="";
 q.a.forEach((opt,i)=>{
  const b=document.createElement("button");
  b.className="p-3 bg-gray-200 rounded";
  b.innerText=opt;
  b.onclick=()=>answer(i);
  grid.appendChild(b);
 });
 updateStars();
}

function answer(i){
 const q=questions[qIndex%questions.length];
 if(i===q.c){
  streak++; mercy=0;
  if(streak>=3) startBonus();
  else loadQuestion();
 } else {
  streak=0; mercy++;
  if(mercy>=5) startBonus();
 }
 qIndex++;
}

function updateStars(){
 document.getElementById("star-bar").innerText="â˜…".repeat(streak)+"â˜†".repeat(3-streak);
}

function startBonus(){
 streak=0; mercy=0;
 show("collect");
 let round=5;
 const spawn=setInterval(spawnItem,300);
 const end=setInterval(()=>{
  round--;
  if(round<=0){
   clearInterval(spawn);
   clearInterval(end);
   if(timeLeft<=0) endGame();
   else { show("quiz"); loadQuestion(); }
  }
 },1000);
}

function spawnItem(){
 const c=document.getElementById("gem-container");
 const d=document.createElement("div");
 const good=Math.random()>0.25;
 d.className="gem";
 d.innerText=good?gems[Math.floor(Math.random()*gems.length)]:trash[Math.floor(Math.random()*trash.length)];
 const x=Math.random()*(window.innerWidth-160)+80;
 d.style.left=x+"px"; d.style.top="-50px";
 c.appendChild(d);
 const anim=d.animate([{top:"-50px"},{top:window.innerHeight+"px"}],{duration:2000});
 d.addEventListener("pointerdown",e=>{
  anim.pause();
  let v=good?50:-100;
  score=Math.max(0,score+v);
  document.getElementById("score-display").innerText="$"+score;
  tap(e.pageX,e.pageY,(v>0?"+":"")+v);
  d.remove();
 });
 anim.onfinish=()=>d.remove();
}

function tap(x,y,t){
 const e=document.createElement("div");
 e.className="tap-effect";
 e.style.left=x+"px"; e.style.top=y+"px";
 e.innerText=t;
 document.body.appendChild(e);
 setTimeout(()=>e.remove(),500);
}

function endGame(){
 gameOver=true;
 show("results");
 document.getElementById("final-name").innerText=nickname+"'s Treasure";
 document.getElementById("final-score").innerText="$"+score;
}
</script>
</body>
</html>
