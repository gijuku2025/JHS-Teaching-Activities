<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>JLPT Kanji Matcher</title>
  <style>
    :root { --gap: 16px; }
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin: 0; padding: 16px; background:#fafafa; }
    h1, h2 { margin: 8px 0; }
    .hidden { display: none; }
    .levels { display: flex; gap: 12px; flex-wrap: wrap; }
    .levels label { background:#fff; padding:8px 12px; border-radius:10px; box-shadow:0 2px 8px rgba(0,0,0,.08); cursor:pointer; }
    .kanji-grid { display:grid; grid-template-columns: repeat(auto-fill, minmax(56px, 1fr)); gap: 10px; margin-top: 12px; }
    .tile { user-select:none; text-align:center; padding:14px 6px; border-radius:12px; background:#fff; box-shadow:0 2px 8px rgba(0,0,0,.1); font-size:22px; cursor:pointer; }
    .tile.reading { font-size:20px; }
    .tile.selected { background:#ffe58a; }
    .tile.matched { background:#9be7b4; }
    .play-area { margin-top: 18px; }
    .top-row { display:grid; grid-template-columns: repeat(auto-fill, minmax(56px, 1fr)); gap: 10px; }
    .bottom-row { margin-top: var(--gap); display:grid; grid-template-columns: repeat(auto-fill, minmax(56px, 1fr)); gap: 10px; }
    .controls { margin-top: 16px; display:flex; gap:12px; }
    button { padding:10px 14px; border-radius:10px; border:none; background:#222; color:#fff; cursor:pointer; }
  </style>
</head>
<body>
  <h1>JLPT Kanji Matcher</h1>

  <!-- START SCREEN -->
  <section id="start">
    <h2>Select level(s)</h2>
    <div class="levels">
      <label><input type="checkbox" value="N5" /> N5</label>
      <label><input type="checkbox" value="N4" /> N4</label>
      <label><input type="checkbox" value="N3" /> N3</label>
    </div>

    <h2>Choose kanji to drill</h2>
    <div id="selectionGrid" class="kanji-grid"></div>

    <div class="controls">
      <button id="startBtn">Start</button>
    </div>
  </section>

  <!-- GAME SCREEN -->
  <section id="game" class="hidden">
    <div class="play-area">
      <div id="topRow" class="top-row"></div>
      <div id="bottomRow" class="bottom-row"></div>
    </div>
    <div class="controls">
      <button id="backBtn">Back to selection</button>
    </div>
  </section>

  <script>
    // -------- DATA (sample; extend safely) --------
    const KANJI = {
  N5: [
    {k:'一',on:'イチ',kun:'ひと'}, {k:'二',on:'ニ',kun:'ふた'}, {k:'三',on:'サン',kun:'み'}, {k:'四',on:'ヨン',kun:'よ'}, {k:'五',on:'ゴ',kun:'いつ'},
    {k:'六',on:'ロク',kun:'む'}, {k:'七',on:'ナナ',kun:'なな'}, {k:'八',on:'ハチ',kun:'や'}, {k:'九',on:'キュウ',kun:'ここの'}, {k:'十',on:'ジュウ',kun:'とお'},
    {k:'百',on:'ヒャク',kun:''}, {k:'千',on:'セン',kun:''}, {k:'日',on:'ニチ',kun:'ひ'}, {k:'月',on:'ゲツ',kun:'つき'}, {k:'火',on:'カ',kun:'ひ'},
    {k:'水',on:'スイ',kun:'みず'}, {k:'木',on:'モク',kun:'き'}, {k:'金',on:'キン',kun:'かね'}, {k:'土',on:'ド',kun:'つち'}, {k:'人',on:'ジン',kun:'ひと'},
    {k:'年',on:'ネン',kun:'とし'}, {k:'時',on:'ジ',kun:'とき'}, {k:'分',on:'フン',kun:'わ'}, {k:'今',on:'コン',kun:'いま'}, {k:'大',on:'ダイ',kun:'おお'},
    {k:'小',on:'ショウ',kun:'ちい'}, {k:'中',on:'チュウ',kun:'なか'}, {k:'上',on:'ジョウ',kun:'うえ'}, {k:'下',on:'カ',kun:'した'}, {k:'左',on:'サ',kun:'ひだり'},
    {k:'右',on:'ウ',kun:'みぎ'}, {k:'前',on:'ゼン',kun:'まえ'}, {k:'後',on:'ゴ',kun:'あと'}, {k:'山',on:'サン',kun:'やま'}, {k:'川',on:'セン',kun:'かわ'},
    {k:'田',on:'デン',kun:'た'}, {k:'口',on:'コウ',kun:'くち'}, {k:'目',on:'モク',kun:'め'}, {k:'耳',on:'ジ',kun:'みみ'}, {k:'手',on:'シュ',kun:'て'},
    {k:'足',on:'ソク',kun:'あし'}, {k:'力',on:'リョク',kun:'ちから'}, {k:'男',on:'ダン',kun:'おとこ'}, {k:'女',on:'ジョ',kun:'おんな'}, {k:'子',on:'シ',kun:'こ'},
    {k:'学',on:'ガク',kun:'まな'}, {k:'校',on:'コウ',kun:''}, {k:'先',on:'セン',kun:'さき'}, {k:'生',on:'セイ',kun:'い'}, {k:'友',on:'ユウ',kun:'とも'},
    {k:'本',on:'ホン',kun:'もと'}, {k:'行',on:'コウ',kun:'い'}, {k:'来',on:'ライ',kun:'く'}, {k:'帰',on:'キ',kun:'かえ'}, {k:'見',on:'ケン',kun:'み'},
    {k:'聞',on:'ブン',kun:'き'}, {k:'話',on:'ワ',kun:'はな'}, {k:'読',on:'ドク',kun:'よ'}, {k:'書',on:'ショ',kun:'か'}, {k:'食',on:'ショク',kun:'た'},
    {k:'飲',on:'イン',kun:'の'}, {k:'買',on:'バイ',kun:'か'}, {k:'出',on:'シュツ',kun:'で'}, {k:'入',on:'ニュウ',kun:'はい'}, {k:'休',on:'キュウ',kun:'やす'},
    {k:'何',on:'カ',kun:'なに'}
  ],
  N4: [
    {k:'会',on:'カイ',kun:'あ'}, {k:'社',on:'シャ',kun:''}, {k:'店',on:'テン',kun:'みせ'}, {k:'駅',on:'エキ',kun:''}, {k:'病',on:'ビョウ',kun:'やまい'}, {k:'院',on:'イン',kun:''},
    {k:'仕',on:'シ',kun:''}, {k:'事',on:'ジ',kun:''}, {k:'働',on:'ドウ',kun:'はたら'}, {k:'思',on:'シ',kun:'おも'}, {k:'考',on:'コウ',kun:'かんが'},
    {k:'作',on:'サク',kun:'つく'}, {k:'使',on:'シ',kun:'つか'}, {k:'借',on:'シャク',kun:'か'}, {k:'貸',on:'タイ',kun:'か'}, {k:'住',on:'ジュウ',kun:'す'},
    {k:'知',on:'チ',kun:'し'}, {k:'待',on:'タイ',kun:'ま'}, {k:'持',on:'ジ',kun:'も'}, {k:'教',on:'キョウ',kun:'おし'}, {k:'習',on:'シュウ',kun:'なら'},
    {k:'強',on:'キョウ',kun:'つよ'}, {k:'弱',on:'ジャク',kun:'よわ'}, {k:'早',on:'ソウ',kun:'はや'}, {k:'近',on:'キン',kun:'ちか'}, {k:'遠',on:'エン',kun:'とお'},
    {k:'重',on:'ジュウ',kun:'おも'}, {k:'軽',on:'ケイ',kun:'かる'}, {k:'暗',on:'アン',kun:'くら'}, {k:'明',on:'メイ',kun:'あか'}, {k:'立',on:'リツ',kun:'た'},
    {k:'歩',on:'ホ',kun:'ある'}, {k:'走',on:'ソウ',kun:'はし'}, {k:'止',on:'シ',kun:'と'}, {k:'起',on:'キ',kun:'お'}, {k:'寝',on:'シン',kun:'ね'}
  ],
  N3: [
    {k:'政',on:'セイ',kun:''}, {k:'治',on:'チ',kun:'おさ'}, {k:'経',on:'ケイ',kun:''}, {k:'済',on:'サイ',kun:''}, {k:'法',on:'ホウ',kun:''}, {k:'律',on:'リツ',kun:''},
    {k:'議',on:'ギ',kun:''}, {k:'員',on:'イン',kun:''}, {k:'選',on:'セン',kun:'えら'}, {k:'挙',on:'キョ',kun:'あ'}, {k:'権',on:'ケン',kun:''}, {k:'義',on:'ギ',kun:''},
    {k:'情',on:'ジョウ',kun:''}, {k:'報',on:'ホウ',kun:''}, {k:'想',on:'ソウ',kun:''}, {k:'感',on:'カン',kun:''}, {k:'覚',on:'カク',kun:'おぼ'}, {k:'決',on:'ケツ',kun:'き'},
    {k:'定',on:'テイ',kun:'さだ'}, {k:'変',on:'ヘン',kun:'か'}, {k:'化',on:'カ',kun:''}, {k:'続',on:'ゾク',kun:'つづ'}, {k:'達',on:'タツ',kun:''}, {k:'対',on:'タイ',kun:''}
  ]
};

    const CHUNK_SIZE = 6;

    // -------- STATE --------
    let selectedLevels = new Set();
    let selectedKanji = [];
    let currentChunk = [];
    let selectedTop = null;

    // -------- ELEMENTS --------
    const startEl = document.getElementById('start');
    const gameEl = document.getElementById('game');
    const selectionGrid = document.getElementById('selectionGrid');
    const topRow = document.getElementById('topRow');
    const bottomRow = document.getElementById('bottomRow');

    // -------- HELPERS --------
    function shuffle(arr) {
      return arr.slice().sort(() => Math.random() - 0.5);
    }

    function readingOf(item) {
      return item.kun || item.on;
    }

    function getLevelSelection() {
      return Array.from(document.querySelectorAll('.levels input:checked')).map(i => i.value);
    }

    // -------- START SCREEN LOGIC --------
    function renderSelection() {
      selectionGrid.innerHTML = '';
      const levels = getLevelSelection();
      let pool = [];
      levels.forEach(l => pool = pool.concat(KANJI[l] || []));
      pool.forEach(item => {
        const d = document.createElement('div');
        d.className = 'tile';
        d.textContent = item.k;
        d.onclick = () => {
          d.classList.toggle('selected');
          if (selectedKanji.includes(item)) {
            selectedKanji = selectedKanji.filter(x => x !== item);
          } else {
            selectedKanji.push(item);
          }
        };
        selectionGrid.appendChild(d);
      });
    }

    document.querySelectorAll('.levels input').forEach(cb => cb.addEventListener('change', () => {
      selectedKanji = [];
      renderSelection();
    }));

    document.getElementById('startBtn').onclick = () => {
      if (!selectedKanji.length) return alert('Select at least one kanji');
      startEl.classList.add('hidden');
      gameEl.classList.remove('hidden');
      loadChunk();
    };

    // -------- GAME LOGIC --------
    function loadChunk() {
      topRow.innerHTML = '';
      bottomRow.innerHTML = '';
      selectedTop = null;
      currentChunk = shuffle(selectedKanji).slice(0, CHUNK_SIZE);

      shuffle(currentChunk).forEach(item => {
        const k = document.createElement('div');
        k.className = 'tile';
        k.textContent = item.k;
        k.onclick = () => selectTop(k, item);
        topRow.appendChild(k);
      });

      shuffle(currentChunk).forEach(item => {
        const r = document.createElement('div');
        r.className = 'tile reading';
        r.textContent = readingOf(item);
        r.onclick = () => tryMatch(r, item);
        bottomRow.appendChild(r);
      });
    }

    function selectTop(el, item) {
      document.querySelectorAll('.top-row .tile').forEach(t => t.classList.remove('selected'));
      el.classList.add('selected');
      selectedTop = { el, item };
    }

    function tryMatch(readingEl, item) {
      if (!selectedTop) return;
      if (selectedTop.item === item) {
        // overwrite reading with kanji
        readingEl.textContent = item.k;
        readingEl.classList.add('matched');
        selectedTop.el.remove(); // top kanji disappears
        selectedTop = null;
      }
    }

    document.getElementById('backBtn').onclick = () => {
      gameEl.classList.add('hidden');
      startEl.classList.remove('hidden');
      topRow.innerHTML = '';
      bottomRow.innerHTML = '';
    };

    // -------- BASIC TESTS --------
    console.assert(CHUNK_SIZE === 6, 'Chunk size should be 6');
    console.assert(typeof shuffle([1,2,3])[0] !== 'undefined', 'Shuffle works');
  </script>
</body>
</html>
