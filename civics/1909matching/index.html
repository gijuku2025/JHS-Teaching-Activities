<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Concept Matching Game</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f5f7fa;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
    }
    .container {
      background: #fff;
      padding: 20px;
      border-radius: 16px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
      text-align: center;
      width: 90%;
      max-width: 800px;
      height: 90%;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }
    #instructions {
      font-size: 18px;
      color: #333;
      margin-bottom: 10px;
    }
    #timer {
      font-size: 22px;
      font-weight: bold;
      color: #333;
      margin-bottom: 15px;
    }
    #card {
      flex-grow: 1;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      background: #fafafa;
      border-radius: 12px;
      padding: 20px;
      font-size: clamp(18px, 2.5vw, 28px);
      line-height: 1.4;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      user-select: none;
      transition: transform 0.3s ease, opacity 0.3s ease;
    }
    .concept { font-weight: bold; margin-bottom: 10px; }
    #endScreen {
      text-align: center;
    }
    .mistake {
      background: #fff;
      border-radius: 12px;
      padding: 12px;
      margin: 8px 0;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      text-align: left;
    }
    #mistakesList {
      max-height: 300px;
      overflow-y: auto;
      margin-top: 15px;
      text-align: left;
    }
    button {
      padding: 12px 20px;
      margin-top: 20px;
      border: none;
      border-radius: 8px;
      background-color: #1E90FF;
      color: white;
      font-size: 18px;
      cursor: pointer;
    }
    button:hover {
      background-color: #1C86EE;
    }
  </style>
</head>
<body>
  <div class="container" id="gameContainer">
    <div id="instructions">Swipe Right = Match | Swipe Left = No Match</div>
    <div id="timer">60</div>
    <div id="card">
      <div class="concept">Loading...</div>
      <div class="example">Please wait</div>
    </div>
  </div>

  <div class="container hidden" id="endScreen" style="display:none;">
    <h1>Timeâ€™s Up!</h1>
    <p id="finalScore"></p>
    <h2>Review Mistakes:</h2>
    <div id="mistakesList"></div>
    <button onclick="location.reload()">Play Again</button>
  </div>

  <script>
    let topicsJSON = [];
    let deck = [];
    let currentIndex = 0;
    let score = 0;
    let mistakes = [];
    let timerInterval;

    const card = document.getElementById("card");
    const conceptDiv = card.querySelector(".concept");
    const exampleDiv = card.querySelector(".example");
    const timerDiv = document.getElementById("timer");
    const gameContainer = document.getElementById("gameContainer");
    const endScreen = document.getElementById("endScreen");
    const finalScore = document.getElementById("finalScore");
    const mistakesList = document.getElementById("mistakesList");

    // Load JSON first
    fetch("concepts.json")
      .then(res => res.json())
      .then(data => {
        topicsJSON = data;
        deck = buildDeck(120); // enough cards for 1 min
        currentIndex = 0;
        showCard();
        startTimer(60);
        enableSwipe();
      })
      .catch(err => {
        console.error("Failed to load concepts.json", err);
        conceptDiv.textContent = "Error loading data";
        exampleDiv.textContent = "";
      });

    function buildDeck(maxCards) {
      let deck = [];
      topicsJSON.forEach(topic => {
        topic.examples.forEach(ex => {
          deck.push({
            topic: topic.topic,
            text: ex.text,
            match: ex.match
          });
        });
      });
      shuffle(deck);
      return deck.slice(0, maxCards);
    }

    function showCard() {
      if (currentIndex >= deck.length) return endGame();
      const ex = deck[currentIndex];
      conceptDiv.textContent = "Concept: " + ex.topic;
      exampleDiv.textContent = "Example: " + ex.text;
      card.style.transform = "translateX(0)";
      card.style.opacity = 1;
    }

    function handleSwipe(direction) {
      const ex = deck[currentIndex];
      const correct = (direction === "right" && ex.match) ||
                      (direction === "left" && !ex.match);

      if (correct) {
        score++;
      } else {
        mistakes.push({
          topic: ex.topic,
          text: ex.text,
          correctAnswer: ex.match ? "Match" : "No Match"
        });
      }

      card.style.transform = direction === "right" ? "translateX(100%)" : "translateX(-100%)";
      card.style.opacity = 0;

      setTimeout(() => {
        currentIndex++;
        if (currentIndex < deck.length) {
          showCard();
        } else {
          endGame();
        }
      }, 300);
    }

    function startTimer(seconds) {
      let timeLeft = seconds;
      timerDiv.textContent = timeLeft;
      timerInterval = setInterval(() => {
        timeLeft--;
        timerDiv.textContent = timeLeft;
        if (timeLeft <= 0) {
          clearInterval(timerInterval);
          endGame();
        }
      }, 1000);
    }

    function endGame() {
      clearInterval(timerInterval);
      gameContainer.style.display = "none";
      endScreen.style.display = "flex";
      finalScore.textContent = "Your Score: " + score;

      mistakesList.innerHTML = "";
      if (mistakes.length === 0) {
        mistakesList.textContent = "No mistakes! Great job ðŸŽ‰";
      } else {
        mistakes.forEach(m => {
          const div = document.createElement("div");
          div.className = "mistake";
          div.innerHTML = `<strong>Topic:</strong> ${m.topic}<br>
                           <strong>Example:</strong> ${m.text}<br>
                           <strong>Correct Answer:</strong> ${m.correctAnswer}`;
          mistakesList.appendChild(div);
        });
      }
    }

    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
    }

    function enableSwipe() {
      let startX = 0;
      card.addEventListener("touchstart", e => {
        startX = e.changedTouches[0].screenX;
      });
      card.addEventListener("touchend", e => {
        let endX = e.changedTouches[0].screenX;
        let diff = endX - startX;
        if (diff > 50) handleSwipe("right");
        else if (diff < -50) handleSwipe("left");
      });
    }
  </script>
</body>
</html>
