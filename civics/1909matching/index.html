<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Concept Match Game</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background-color: #f2f2f2;
    margin: 0;
    padding: 0;
    overflow: hidden;
  }
  #game-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    height: 100vh;
    width: 100vw;
    position: relative;
  }
  #top-bar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    width: 90%;
    max-width: 800px;
    margin-top: 10px;
    font-size: 1.2em;
  }
  #flash-icon {
    position: absolute;
    top: 60px;
    font-size: 4em;
    opacity: 0;
    transition: opacity 0.5s ease-out, transform 0.5s ease-out;
    z-index: 5;
  }
  #card-container {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    width: 90%;
    max-width: 700px;
    height: 70%;
    margin-top: 20px;
  }
  .card {
    position: absolute;
    width: 100%;
    height: 100%;
    background: white;
    border-radius: 15px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    padding: 20px;
    text-align: center;
    font-size: 1.4em;
    transition: transform 0.3s ease, opacity 0.3s ease;
  }
  #side-icons {
    position: absolute;
    top: 50%;
    width: 90%;
    max-width: 700px;
    display: flex;
    justify-content: space-between;
    pointer-events: none;
    font-size: 2.5em;
    opacity: 0.3;
  }
  #instructions {
    margin-bottom: 15px;
    font-size: 1em;
    color: #333;
  }
  #start-overlay, #end-overlay {
    position: absolute;
    top:0; left:0;
    width: 100%; height: 100%;
    background: rgba(242,242,242,0.95);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    z-index: 10;
    text-align: center;
    padding: 20px;
  }
  #end-overlay {
    overflow-y: auto;
  }
  button {
    margin-top: 20px;
    padding: 10px 20px;
    font-size: 1.2em;
    border: none;
    border-radius: 10px;
    background: #007bff;
    color: white;
    cursor: pointer;
  }
  button:hover {
    background: #0056b3;
  }
  #review-list {
    text-align: left;
    margin-top: 20px;
    max-width: 600px;
  }
  #review-list h3 {
    margin-bottom: 10px;
  }
  #review-list ul {
    list-style: none;
    padding: 0;
  }
  #review-list li {
    background: #fff;
    margin-bottom: 10px;
    padding: 10px;
    border-radius: 8px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    font-size: 1em;
  }
</style>
</head>
<body>
<div id="game-container">
  <div id="top-bar">
    <div id="score">Score: 0</div>
    <div id="timer">60s</div>
  </div>
  <div id="flash-icon"></div>
  <div id="card-container"></div>
  <div id="side-icons">
    <div>❌</div>
    <div>✅</div>
  </div>
  <div id="instructions">Swipe right = Match, Swipe left = No Match</div>
  <div id="start-overlay">
    <h2>Concept Match Game</h2>
    <p>Swipe right if the example matches the concept.<br>
    Swipe left if it does not. You have 60 seconds.</p>
    <button id="start-btn">Start</button>
  </div>
  <div id="end-overlay" style="display:none;">
    <h2>Time's up!</h2>
    <div id="final-score"></div>
    <div id="review-list"></div>
    <button onclick="location.reload()">Play Again</button>
  </div>
</div>

<script>
let topicsJSON = [];
let deck = [];
let currentIndex = 0;
let score = 0;
let timerInterval;
let timeLeft = 60;
let incorrectAnswers = [];

// Fetch JSON
fetch("concepts.json")
  .then(res => res.json())
  .then(data => {
    topicsJSON = data;
  })
  .catch(err => console.error("Failed to load concepts.json", err));

function buildDeck(n) {
  const d = [];
  for (let i = 0; i < n; i++) {
    const topic = topicsJSON[Math.floor(Math.random() * topicsJSON.length)];
    const ex = topic.examples[Math.floor(Math.random() * topic.examples.length)];
    d.push({concept: topic.topic, example: ex.text, isMatch: ex.match});
  }
  return d;
}

function showCard() {
  if (currentIndex >= deck.length) return;
  const cardData = deck[currentIndex];
  const container = document.getElementById("card-container");
  container.innerHTML = "";
  const card = document.createElement("div");
  card.className = "card";
  card.innerHTML = `<strong>Concept:</strong> ${cardData.concept}<br><br>
                    <strong>Example:</strong> ${cardData.example}`;
  container.appendChild(card);

  let startX = 0;
  card.addEventListener("touchstart", e => {
    startX = e.touches[0].clientX;
  });
  card.addEventListener("touchend", e => {
    const endX = e.changedTouches[0].clientX;
    handleSwipe(endX - startX, cardData);
  });
}

function handleSwipe(dx, cardData) {
  const threshold = 50;
  if (Math.abs(dx) > threshold) {
    const isRight = dx > 0;
    const correct = (isRight && cardData.isMatch) || (!isRight && !cardData.isMatch);

    if (correct) {
      score++;
      showFlash("✅", "green");
    } else {
      showFlash("❌", "red");
      incorrectAnswers.push(cardData);
    }
    document.getElementById("score").textContent = "Score: " + score;
    currentIndex++;
    showCard();
  }
}

function showFlash(symbol, color) {
  const flash = document.getElementById("flash-icon");
  flash.textContent = symbol;
  flash.style.color = color;
  flash.style.opacity = 1;
  flash.style.transform = "scale(1.2)";
  setTimeout(() => {
    flash.style.opacity = 0;
    flash.style.transform = "scale(1)";
  }, 700);
}

function startGame() {
  document.getElementById("start-overlay").style.display = "none";
  deck = buildDeck(100);
  currentIndex = 0;
  score = 0;
  incorrectAnswers = [];
  timeLeft = 60;
  document.getElementById("score").textContent = "Score: 0";
  document.getElementById("timer").textContent = "60s";
  showCard();
  timerInterval = setInterval(() => {
    timeLeft--;
    document.getElementById("timer").textContent = timeLeft + "s";
    if (timeLeft <= 0) {
      endGame();
    }
  }, 1000);
}

function endGame() {
  clearInterval(timerInterval);
  document.getElementById("end-overlay").style.display = "flex";
  document.getElementById("final-score").textContent = "Final Score: " + score;

  const reviewDiv = document.getElementById("review-list");
  if (incorrectAnswers.length > 0) {
    let html = "<h3>Review Incorrect Matches:</h3><ul>";
    incorrectAnswers.forEach(item => {
      html += `<li><strong>Concept:</strong> ${item.concept}<br>
                   <strong>Example:</strong> ${item.example}</li>`;
    });
    html += "</ul>";
    reviewDiv.innerHTML = html;
  } else {
    reviewDiv.innerHTML = "<h3>No mistakes! Great job!</h3>";
  }
}

document.getElementById("start-btn").addEventListener("click", startGame);
</script>
</body>
</html>
