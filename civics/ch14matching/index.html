<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Concept Matching Game</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background-color: #f5f7fa;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    margin: 0;
    overflow: hidden;
  }
  .container {
    background: #fff;
    padding: 20px;
    border-radius: 16px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    text-align: center;
    width: 380px;
    position: relative;
  }
  h1 { font-size: 20px; margin-bottom: 12px; color: #333; }
  input[type="text"] { padding: 10px; width: 80%; border: 1px solid #ccc; border-radius: 8px; margin-bottom: 20px; }
  button {
    padding: 12px; margin: 8px 0; width: 100%; border: none;
    border-radius: 8px; font-size: 16px; cursor: pointer; transition: background 0.2s;
  }
  .primary { background-color: #4CAF50; color: white; }
  .primary:hover { background-color: #45a049; }
  #scoreTimer {
    display: flex;
    justify-content: space-between;
    margin-bottom: 8px;
    font-weight: bold;
    font-size: 16px;
  }
  .instructions { font-size: 14px; margin-bottom: 10px; color: #555; }
  .card-container {
    position: relative;
    width: 100%;
    height: 140px;
    border: 2px solid #ccc;
    border-radius: 12px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    background: #fafafa;
    font-size: 16px;
    padding: 10px;
  }
  .card-concept { font-weight: bold; margin-bottom: 5px; }
  .flash-feedback {
    font-size: 36px;
    position: absolute;
    top: -60px;
    left: 50%;
    transform: translateX(-50%);
    display: none;
    transition: opacity 0.3s ease;
  }
  .flash-feedback.show { display: block; animation: flash 0.5s ease; }
  @keyframes flash {
    0% { transform: translateX(-50%) scale(1); opacity: 1; }
    50% { transform: translateX(-50%) scale(1.3); opacity: 1; }
    100% { transform: translateX(-50%) scale(1); opacity: 0; }
  }
  .side-icon {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    font-size: 32px;
  }
  .left-icon { left: -50px; color: #ff4c4c; }
  .right-icon { right: -50px; color: #4CAF50; }
  #reviewList {
    max-height: 200px;
    overflow-y: auto;
    text-align: left;
    padding-left: 10px;
  }
</style>
</head>
<body>

<div class="container" id="startScreen">
  <h1>Enter Nickname</h1>
  <input type="text" id="nickname" placeholder="Your name">
  <button class="primary" id="startBtn">Start Game</button>
</div>

<div class="container hidden" id="gameScreen">
  <div class="flash-feedback" id="flashFeedback">✔</div>
  <div id="scoreTimer">
    <div id="timer">Time: 60</div>
    <div id="score">Score: 0</div>
  </div>
  <div class="instructions">
    Swipe right if the example matches the concept. Swipe left if it does not.
  </div>
  <div class="card-container" id="card">
    <div class="card-concept" id="cardConcept"></div>
    <div class="card-example" id="cardExample"></div>
    <div class="side-icon left-icon">✖</div>
    <div class="side-icon right-icon">✔</div>
  </div>
</div>

<div class="container hidden" id="endScreen">
  <h1>Game Over!</h1>
  <p id="finalScore"></p>
  <div id="reviewList"></div>
  <button class="primary" id="playAgainBtn">Play Again</button>
</div>

<script>
let concepts = [];
let currentIndex = 0;
let score = 0;
let nickname = '';
let timer = 60;
let timerInterval;
let incorrectAnswers = [];

const startScreen = document.getElementById('startScreen');
const gameScreen = document.getElementById('gameScreen');
const endScreen = document.getElementById('endScreen');
const card = document.getElementById('card');
const cardConcept = document.getElementById('cardConcept');
const cardExample = document.getElementById('cardExample');
const flashFeedback = document.getElementById('flashFeedback');
const scoreEl = document.getElementById('score');
const timerEl = document.getElementById('timer');
const finalScoreEl = document.getElementById('finalScore');
const reviewList = document.getElementById('reviewList');
const startBtn = document.getElementById('startBtn');
const playAgainBtn = document.getElementById('playAgainBtn');

// Fetch concepts from JSON
fetch('concepts.json')
.then(res => res.json())
.then(data => {
  concepts = [];
  data.forEach(item => {
    item.examples.forEach(ex => {
      concepts.push({
        topic: item.topic,
        text: ex.text,
        match: ex.match
      });
    });
  });
});

startBtn.addEventListener('click', () => {
  nickname = document.getElementById('nickname').value.trim() || 'Player';
  startScreen.classList.add('hidden');
  gameScreen.classList.remove('hidden');
  startGame();
});

function startGame(){
  currentIndex = 0;
  score = 0;
  incorrectAnswers = [];
  timer = 60;
  updateScore();
  updateCard();
  timerInterval = setInterval(() => {
    timer--;
    timerEl.textContent = `Time: ${timer}`;
    if(timer <= 0) endGame();
  },1000);
}

function updateScore(){
  scoreEl.textContent = `Score: ${score}`;
}

function updateCard(){
  if(currentIndex >= concepts.length || timer <=0){
    endGame();
    return;
  }
  const current = concepts[currentIndex];
  cardConcept.textContent = current.topic;
  cardExample.textContent = current.text;
  flashFeedback.style.display = 'none';
}

function flash(correct){
  flashFeedback.textContent = correct ? '✔' : '✖';
  flashFeedback.classList.add('show');
  setTimeout(()=>flashFeedback.classList.remove('show'),500);
}

function handleSwipe(isMatch){
  const current = concepts[currentIndex];
  const correct = current.match;
  if(isMatch === correct) {
    score += 1;
    flash(true);
  } else {
    incorrectAnswers.push({
      concept: current.topic,
      example: current.text,
      correct: correct ? 'Match' : 'No Match'
    });
    flash(false);
  }
  updateScore();
  currentIndex++;
  setTimeout(updateCard, 300);
}

// Swipe detection
let startX = 0;
card.addEventListener('touchstart', e => startX = e.touches[0].clientX);
card.addEventListener('touchend', e => {
  let endX = e.changedTouches[0].clientX;
  if(endX - startX > 50) handleSwipe(true);
  else if(startX - endX > 50) handleSwipe(false);
});

// For desktop testing
card.addEventListener('mousedown', e => startX = e.clientX);
card.addEventListener('mouseup', e => {
  let endX = event.clientX;
  if(endX - startX > 50) handleSwipe(true);
  else if(startX - endX > 50) handleSwipe(false);
});

function endGame(){
  clearInterval(timerInterval);
  gameScreen.classList.add('hidden');
  endScreen.classList.remove('hidden');

  const now = new Date();
  const year = now.getFullYear();
  const month = String(now.getMonth()+1).padStart(2,'0');
  const day = String(now.getDate()).padStart(2,'0');
  const hours = String(now.getHours()).padStart(2,'0');
  const minutes = String(now.getMinutes()).padStart(2,'0');

  const dateTime = `${year}-${month}-${day} ${hours}:${minutes}`;

  finalScoreEl.innerHTML = `${'Concept Matching Game'} — Score (${nickname}) — ${dateTime}: ${score}`;

  reviewList.innerHTML = '';
  if(incorrectAnswers.length === 0){
    let li = document.createElement('li');
    li.textContent = 'No mistakes! Great job!';
    reviewList.appendChild(li);
  } else {
    incorrectAnswers.forEach(item=>{
      let li = document.createElement('li');
      li.innerHTML = `<strong>Concept:</strong> ${item.concept}<br>
                      <strong>Example:</strong> ${item.example}<br>
                      <strong>Correct Answer:</strong> ${item.correct}`;
      reviewList.appendChild(li);
    });
  }
}

playAgainBtn.addEventListener('click',()=>location.reload());
</script>
</body>
</html>
