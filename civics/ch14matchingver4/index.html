<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Concept Match Game</title>
<style>
body {
  font-family: Arial, sans-serif;
  background: #f5f7fa;
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
  margin: 0;
}

.game-container {
  background: #fff;
  padding: 30px;
  border-radius: 16px;
  box-shadow: 0 4px 20px rgba(0,0,0,0.1);
  width: 380px;       /* match quiz container width */
  max-width: 90%;
  text-align: center;
  position: relative;
  min-height: 450px;   /* enough to fit header, game area, and end screen */
}

#header {
  position: relative;
  margin-bottom: 20px;
}

#concept {
  font-size: 24px;
  font-weight: bold;
  margin: 0;
  color: #333;
}

#feedback {
  font-size: 18px;
  font-weight: bold;
  margin-top: 8px;
  min-height: 24px;
  color: #333;
}

#timer {
  position: absolute;
  right: 0;
  top: 0;
  font-size: 18px;
  font-weight: bold;
  color: #333;
}

#game {
  position: relative;
  width: 100%;
  height: 150px;   /* fits nicely inside container */
  margin-top: 10px;
}

.card {
  position: absolute;
  width: 100%;
  height: 100%;      /* fills #game area */
  border-radius: 16px;
  box-shadow: 0 4px 20px rgba(0,0,0,0.1);
  display: flex;
  align-items: center;
  justify-content: center;
  text-align: center;
  font-size: 16px;   /* smaller font to fit container */
  color: #fff;
  cursor: grab;
  padding: 16px;     /* reduced padding */
  transition: transform 0.3s ease, opacity 0.3s ease, background-color 0.3s ease;
}

.indicator {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  display: flex;
  align-items: center;
  opacity: 0.5;
}

#leftIndicator { left: -80px; }
#rightIndicator { right: -80px; }

.indicator svg { width: 50px; height: 50px; }

#endScreen {
  display: none;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  margin-top: 20px;
}

#endScreen h2 { font-size: 24px; margin-bottom: 12px; color: #333; }
#restartBtn {
  padding: 12px;
  font-size: 16px;
  border: none;
  border-radius: 8px;
  background: #1E90FF;
  color: #fff;
  cursor: pointer;
}
#restartBtn:hover { background: #1C86EE; }

@media (max-width: 768px) {
  .game-container { width: 90%; padding: 20px; }
  #concept { font-size: 20px; }
  #timer { font-size: 16px; }
  .card { font-size: 14px; height: 120px; padding: 12px; }
}
</style>
</head>
<body>

<div class="game-container">
  <div id="header">
    <h1 id="concept">Concept</h1>
    <div id="feedback"></div>
    <div id="timer">60</div>
  </div>

  <div id="game">
    <div id="leftIndicator" class="indicator">
      <svg viewBox="0 0 24 24" fill="red" xmlns="http://www.w3.org/2000/svg">
        <path d="M18.364 5.636l-1.414-1.414L12 9.172 7.05 4.222 5.636 5.636 10.586 10.586 5.636 15.536l1.414 1.414L12 12l4.95 4.95 1.414-1.414L13.414 10.586z"/>
      </svg>
    </div>
    <div id="rightIndicator" class="indicator">
      <svg viewBox="0 0 24 24" fill="green" xmlns="http://www.w3.org/2000/svg">
        <path d="M20.285 6.709l-11.285 11.29-5.285-5.29 1.42-1.418 3.865 3.871 9.865-9.873z"/>
      </svg>
    </div>
  </div>

  <div id="endScreen">
    <h2 id="finalTitle"></h2>
    <p id="score"></p>
    <button id="restartBtn">Play Again</button>
  </div>
</div>

<script>
const colors = ["#FFA500", "#FF4C4C", "#4CAF50"];
let score = 0;
let timeLeft = 60;
let timerInterval;
let gameActive = false;
let allExamples = [];
let usedExamples = new Set();

const conceptEl = document.getElementById("concept");
const feedbackEl = document.getElementById("feedback");
const timerEl = document.getElementById("timer");
const gameEl = document.getElementById("game");
const endScreen = document.getElementById("endScreen");
const finalTitle = document.getElementById("finalTitle");
const scoreEl = document.getElementById("score");
const restartBtn = document.getElementById("restartBtn");

// Load JSON concepts
fetch('concepts.json')
  .then(res => res.json())
  .then(data => {
    allExamples = [];
    data.forEach(concept => {
      concept.examples.forEach(ex => {
        allExamples.push({ topic: concept.topic, text: ex.text, match: ex.match });
      });
    });
    startGame();
  });

function startGame() {
  score = 0;
  timeLeft = 60;
  gameActive = true;
  usedExamples.clear();
  feedbackEl.textContent = "";
  endScreen.style.display = "none";
  gameEl.querySelectorAll('.card').forEach(c => c.remove());
  timerEl.textContent = timeLeft;

  timerInterval = setInterval(() => {
    timeLeft--;
    timerEl.textContent = timeLeft;
    if (timeLeft <= 0) endGame();
  }, 1000);

  nextCard();
}

function endGame() {
  gameActive = false;
  clearInterval(timerInterval);
  gameEl.querySelectorAll('.card').forEach(c => c.remove());
  endScreen.style.display = "flex";
  finalTitle.textContent = "Concept Match Game";
  scoreEl.textContent = "Your score: " + score;
}

function nextCard() {
  if (!gameActive || allExamples.length === 0) return;

  let example;
  do {
    example = allExamples[Math.floor(Math.random() * allExamples.length)];
  } while (usedExamples.has(example.text) && usedExamples.size < allExamples.length);

  usedExamples.add(example.text);

  conceptEl.textContent = example.topic;

  const card = document.createElement("div");
  card.className = "card";
  card.textContent = example.text;
  card.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
  gameEl.appendChild(card);

  let startX = 0, currentX = 0, offsetX = 0;

  function onStart(e) {
    startX = e.type.includes("mouse") ? e.clientX : e.touches[0].clientX;
    document.addEventListener("mousemove", onMove);
    document.addEventListener("mouseup", onEnd);
    document.addEventListener("touchmove", onMove);
    document.addEventListener("touchend", onEnd);
  }

  function onMove(e) {
    currentX = e.type.includes("mouse") ? e.clientX : e.touches[0].clientX;
    offsetX = currentX - startX;
    card.style.transform = `translate(${offsetX}px, 0) rotate(${offsetX/10}deg)`;
  }

  function onEnd() {
    document.removeEventListener("mousemove", onMove);
    document.removeEventListener("mouseup", onEnd);
    document.removeEventListener("touchmove", onMove);
    document.removeEventListener("touchend", onEnd);

    if (Math.abs(offsetX) > 100) {
      const isRight = offsetX > 0;
      handleChoice(isRight, example.match);
      card.style.transition = "transform 0.3s ease, opacity 0.3s ease";
      card.style.transform = `translate(${isRight ? 500 : -500}px, 0) rotate(${offsetX/10}deg)`;
      card.style.opacity = 0;
      setTimeout(() => {
        gameEl.removeChild(card);
        if (gameActive) nextCard();
      }, 300);
    } else {
      card.style.transition = "transform 0.3s ease";
      card.style.transform = "translate(0,0)";
    }
  }

  card.addEventListener("mousedown", onStart);
  card.addEventListener("touchstart", onStart);
}

function handleChoice(swipeRight, isMatch) {
  const correct = (swipeRight && isMatch) || (!swipeRight && !isMatch);
  if (correct) {
    score++;
    feedbackEl.textContent = "Correct!";
    feedbackEl.style.color = "#4CAF50";
  } else {
    feedbackEl.textContent = "Wrong!";
    feedbackEl.style.color = "#FF4C4C";
  }
  setTimeout(() => feedbackEl.textContent = "", 700);
}

restartBtn.addEventListener("click", startGame);
</script>

</body>
</html>
