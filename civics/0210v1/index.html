<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>True/False Quiz</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background-color: #f5f7fa;
    margin: 0;
    padding: 0;
    height: 100vh;
  }

  /* Full-screen nickname input */
  #nickname-container {
    width: 100%;
    height: 100vh;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    background: #f5f7fa;
    position: fixed;
    top: 0;
    left: 0;
    z-index: 10;
  }
  #nickname-container input {
    padding: 10px;
    font-size: 1em;
    margin-bottom: 10px;
    border-radius: 6px;
    border: 1px solid #ccc;
  }
  #nickname-container button {
    padding: 10px 20px;
    font-size: 1em;
    border: none;
    border-radius: 8px;
    background: #007bff;
    color: #fff;
    cursor: pointer;
  }

  #game-container {
    width: 90%;
    max-width: 700px;
    margin: 0 auto;
    text-align: center;
    display: none; /* hidden until nickname is entered */
  }

  /* Top Bar */
  #top-bar {
    display: flex;
    justify-content: space-between;
    margin-bottom: 10px;
    font-size: 1.2em;
    font-weight: bold;
    color: #333;
  }

  /* Flash Icon */
  #flash-icon {
    font-size: 4em;
    opacity: 0;
    transition: opacity 0.4s ease, transform 0.4s ease;
    text-align: center;
    margin-bottom: 10px;
  }

  /* Instructions */
  #instructions {
    margin-bottom: 15px;
    font-size: 1em;
    color: #555;
  }

  /* Card Area */
  #card-container {
    position: relative;
    width: 100%;
    height: 200px;
    margin-bottom: 10px;
    overflow: visible;
  }
  #card {
    width: 100%;
    height: 100%;
    background: #fff;
    border-radius: 16px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 1.2em;
    padding: 10px;
    box-sizing: border-box;
    user-select: none;
    text-align: center;
    position: relative;
    transition: transform 0.3s ease, opacity 0.3s ease;
    z-index: 1;
  }

  /* Persistent Side Icons */
  #icon-left, #icon-right {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    font-size: 3em;
    opacity: 0.3; 
    pointer-events: none; 
    z-index: 2;
  }
  #icon-left { left: -80px; color: #FF4C4C; }
  #icon-right { right: -80px; color: #4CAF50; }

  /* Review Section */
  #review-container {
    display: none;
    width: 100%;
    height: 30vh;
    overflow-y: auto;
    margin-top: 20px;
    border-top: 2px solid #ccc;
    padding-top: 10px;
    background: #f9f9f9;
    border-radius: 10px;
    text-align: left;
  }
  #review-container ul {
    list-style: none;
    padding: 0;
    margin: 0;
  }
  #review-container li {
    margin-bottom: 8px;
    padding: 8px;
    background: #fff;
    border-radius: 6px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  }

  /* Play Again Button */
  #play-again-btn {
    display: none;
    margin-top: 10px;
    padding: 10px 20px;
    font-size: 1.1em;
    border: none;
    border-radius: 10px;
    background: #007bff;
    color: #fff;
    cursor: pointer;
  }
</style>
</head>
<body>

<!-- Nickname input screen -->
<div id="nickname-container">
  <h2>Enter your nickname</h2>
  <input type="text" id="nickname-input" placeholder="Your nickname">
  <button id="start-btn">Start Quiz</button>
</div>

<!-- Main game container -->
<div id="game-container">
  <div id="top-bar">
    <div id="timer">60</div>
    <div id="score">Score: 0</div>
  </div>

  <div id="flash-icon">✔</div>
  <div id="instructions">Swipe right = True, Swipe left = False</div>

  <div id="card-container">
    <div id="card"></div>
    <div id="icon-left">❌</div>
    <div id="icon-right">✅</div>
  </div>

  <div id="review-container">
    <h3>Review Incorrect Answers:</h3>
    <ul id="review-list"></ul>
  </div>
  <button id="play-again-btn">Play Again</button>
</div>

<script>
const quizTitle = "True/False Quiz"; // change title here in future
let concepts = [];
let currentCard = {};
let score = 0;
let timer = 60;
let timerInterval;
let incorrectAnswers = [];
let nickname = "";
let cardEl = document.getElementById('card');

const nicknameContainer = document.getElementById('nickname-container');
const nicknameInput = document.getElementById('nickname-input');
const startBtn = document.getElementById('start-btn');
const gameContainer = document.getElementById('game-container');

// DOM Elements
const iconLeft = document.getElementById('icon-left');
const iconRight = document.getElementById('icon-right');
const flashIcon = document.getElementById('flash-icon');
const scoreEl = document.getElementById('score');
const timerEl = document.getElementById('timer');
const reviewContainer = document.getElementById('review-container');
const reviewList = document.getElementById('review-list');
const playAgainBtn = document.getElementById('play-again-btn');

// Start button click
startBtn.onclick = () => {
  const value = nicknameInput.value.trim();
  if(value === "") {
    alert("Please enter a nickname!");
    return;
  }
  nickname = value;
  nicknameContainer.style.display = "none";
  gameContainer.style.display = "block";
  startGame();
};

// Fetch statements from JSON
fetch('concepts.json')
  .then(res => res.json())
  .then(data => { concepts = data; })
  .catch(err => console.error('Failed to load JSON:', err));

// Start Game
function startGame() {
  score = 0;
  timer = 60;
  incorrectAnswers = [];
  updateScore();
  showNextCard();
  timerInterval = setInterval(() => {
    timer--;
    timerEl.textContent = timer;
    if(timer <= 0){
      endGame();
    }
  }, 1000);
}

// Show next card
function showNextCard() {
  currentCard = concepts[Math.floor(Math.random() * concepts.length)];
  cardEl.style.transition = 'none';
  cardEl.style.transform = 'translateX(0) rotate(0deg)';
  cardEl.style.opacity = 1;
  cardEl.innerHTML = `<div>${currentCard.statement}</div>`;
  flashIcon.style.opacity = 0;
}

// Swipe handling
let startX = 0;
cardEl.addEventListener('touchstart', e => { startX = e.touches[0].clientX; });
cardEl.addEventListener('touchend', e => {
  let diff = e.changedTouches[0].clientX - startX;
  if(diff > 30) handleSwipe('right');
  else if(diff < -30) handleSwipe('left');
});
cardEl.addEventListener('mousedown', e => { startX = e.clientX; });
cardEl.addEventListener('mouseup', e => {
  let diff = e.clientX - startX;
  if(diff > 30) handleSwipe('right');
  else if(diff < -30) handleSwipe('left');
});

function handleSwipe(direction){
  let correct = (direction === 'right' && currentCard.answer === true) ||
                (direction === 'left' && currentCard.answer === false);
  if(!correct) incorrectAnswers.push(currentCard);

  flash(correct ? '✔' : '✖');

  cardEl.style.transition = 'transform 0.3s ease, opacity 0.3s ease';
  cardEl.style.transform = direction === 'right' ? 'translateX(120%) rotate(15deg)' : 'translateX(-120%) rotate(-15deg)';
  cardEl.style.opacity = 0;

  setTimeout(() => {
    if(timer <= 0) return;
    if(correct) score += 1;
    updateScore();
    showNextCard();
  }, 300);
}

function updateScore() { scoreEl.textContent = `Score: ${score}`; }

function flash(symbol){
  flashIcon.textContent = symbol;
  flashIcon.style.opacity = 1;
  flashIcon.style.transform = 'scale(1.2)';
  setTimeout(() => {
    flashIcon.style.opacity = 0;
    flashIcon.style.transform = 'scale(1)';
  }, 600);
}

// End Game
function endGame(){
  clearInterval(timerInterval);
  reviewContainer.style.display = 'block';
  reviewList.innerHTML = '';

  const now = new Date();
  const dateStr = now.toLocaleDateString();
  const timeStr = now.toLocaleTimeString();

  // Show nickname, score, quiz title, date/time
  const finalScoreEl = document.createElement('p');
  finalScoreEl.innerHTML = `
    <strong>${nickname}</strong>, your final score is <strong>${score}</strong><br>
    Quiz: <strong>${quizTitle}</strong><br>
    Date: <strong>${dateStr}</strong> Time: <strong>${timeStr}</strong>
  `;
  reviewContainer.prepend(finalScoreEl);

  if(incorrectAnswers.length === 0){
    let li = document.createElement('li');
    li.textContent = 'No mistakes! Great job!';
    reviewList.appendChild(li);
  } else {
    incorrectAnswers.forEach(item => {
      let li = document.createElement('li');
      li.innerHTML = `
        <strong>Statement:</strong> ${item.statement}<br>
        <strong>Correct Answer:</strong> ${item.answer ? 'True' : 'False'}
      `;
      reviewList.appendChild(li);
    });
  }
  playAgainBtn.style.display = 'inline-block';
  playAgainBtn.onclick = () => location.reload();
}
</script>
</body>
</html>