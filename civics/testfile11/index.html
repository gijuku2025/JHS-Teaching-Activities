<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>JLPT Kanji Drag & Drop Drill</title>
<style>
body { font-family: -apple-system, BlinkMacSystemFont, sans-serif; margin: 0; padding: 12px; }
.hidden { display: none; }
h2 { margin-top: 0; }
.level { margin-bottom: 16px; }
.level-toggle { font-weight: bold; margin-bottom: 6px; }
.kanji-select { display: flex; flex-wrap: wrap; gap: 6px; margin-top: 6px; }
.kanji-select label { border: 1px solid #ccc; padding: 6px 8px; border-radius: 6px; cursor: pointer; }
.kanji-select input { display: none; }
.kanji-select input:checked + span { background: #ffe680; }
.kanji-select span { padding: 4px 6px; border-radius: 4px; display: inline-block; }
button { padding: 10px 16px; font-size: 16px; }

#kanjiTray, #readingTray {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(64px, 1fr));
  gap: 8px;
}
#kanjiTray { margin-bottom: 24px; }

.tile {
  border: 2px solid #444;
  border-radius: 10px;
  text-align: center;
  padding: 8px;
  user-select: none;
  background: #fff;
}
.kanji-tile { font-size: 28px; cursor: pointer; }
.kanji-tile.selected { background: #ffe680; }
.reading-tile {
  font-size: 20px;
  min-height: 64px;
  display: flex;
  align-items: center;
  justify-content: center;
  position: relative;
}
.correct { background: #b6f2c2; border-color: #2a8a44; }
.overlay-kanji {
  position: absolute;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 28px;
}
</style>
</head>
<body>

<div id="startScreen">
  <h2>Select Kanji to Drill</h2>
  <div id="levels"></div>
  <button id="startDrill">Start</button>
</div>

<div id="drillScreen" class="hidden">
  <div id="kanjiTray"></div>
  <div id="readingTray"></div>
</div>

<script>
const LEVELS = {
  N5: [
    {k:'一',on:'イチ',kun:'ひと'},{k:'二',on:'ニ',kun:'ふた'},{k:'三',on:'サン',kun:'み'},
    {k:'四',on:'ヨン',kun:'よ'},{k:'五',on:'ゴ',kun:'いつ'},
    {k:'六',on:'ロク',kun:'む'},{k:'七',on:'ナナ',kun:'なな'},
    {k:'八',on:'ハチ',kun:'や'},{k:'九',on:'キュウ',kun:'ここの'},
    {k:'十',on:'ジュウ',kun:'とお'},{k:'百',on:'ヒャク',kun:''},{k:'千',on:'セン',kun:''},
    {k:'日',on:'ニチ',kun:'ひ'},{k:'月',on:'ゲツ',kun:'つき'},
    {k:'火',on:'カ',kun:'ひ'},{k:'水',on:'スイ',kun:'みず'},
    {k:'木',on:'モク',kun:'き'},{k:'金',on:'キン',kun:'かね'},
    {k:'土',on:'ド',kun:'つち'},
    {k:'人',on:'ジン',kun:'ひと'},{k:'年',on:'ネン',kun:'とし'},
    {k:'時',on:'ジ',kun:'とき'},{k:'分',on:'フン',kun:'わ'},
    {k:'今',on:'コン',kun:'いま'},
    {k:'大',on:'ダイ',kun:'おお'},{k:'小',on:'ショウ',kun:'ちい'},
    {k:'中',on:'チュウ',kun:'なか'},{k:'上',on:'ジョウ',kun:'うえ'},
    {k:'下',on:'カ',kun:'した'},
    {k:'左',on:'サ',kun:'ひだり'},{k:'右',on:'ウ',kun:'みぎ'},
    {k:'前',on:'ゼン',kun:'まえ'},{k:'後',on:'ゴ',kun:'あと'},
    {k:'山',on:'サン',kun:'やま'},{k:'川',on:'セン',kun:'かわ'},
    {k:'田',on:'デン',kun:'た'},
    {k:'口',on:'コウ',kun:'くち'},{k:'目',on:'モク',kun:'め'},
    {k:'耳',on:'ジ',kun:'みみ'},
    {k:'手',on:'シュ',kun:'て'},{k:'足',on:'ソク',kun:'あし'},
    {k:'力',on:'リョク',kun:'ちから'},
    {k:'男',on:'ダン',kun:'おとこ'},{k:'女',on:'ジョ',kun:'おんな'},
    {k:'子',on:'シ',kun:'こ'},
    {k:'学',on:'ガク',kun:'まな'},{k:'校',on:'コウ',kun:''},
    {k:'先',on:'セン',kun:'さき'},{k:'生',on:'セイ',kun:'い'},
    {k:'本',on:'ホン',kun:'もと'},
    {k:'行',on:'コウ',kun:'い'},{k:'来',on:'ライ',kun:'く'},
    {k:'帰',on:'キ',kun:'かえ'},
    {k:'見',on:'ケン',kun:'み'},{k:'聞',on:'ブン',kun:'き'},
    {k:'話',on:'ワ',kun:'はな'},
    {k:'読',on:'ドク',kun:'よ'},{k:'書',on:'ショ',kun:'か'},
    {k:'食',on:'ショク',kun:'た'},{k:'飲',on:'イン',kun:'の'},
    {k:'買',on:'バイ',kun:'か'},
    {k:'出',on:'シュツ',kun:'で'},{k:'入',on:'ニュウ',kun:'はい'},
    {k:'休',on:'キュウ',kun:'やす'},
    {k:'何',on:'カ',kun:'なに'}
  ],

  N4: [
    {k:'会',on:'カイ',kun:'あ'},{k:'社',on:'シャ',kun:''},{k:'店',on:'テン',kun:'みせ'},
    {k:'駅',on:'エキ',kun:''},{k:'病',on:'ビョウ',kun:'やまい'},
    {k:'院',on:'イン',kun:''},{k:'仕',on:'シ',kun:''},{k:'事',on:'ジ',kun:'こと'},
    {k:'働',on:'ドウ',kun:'はたら'},{k:'思',on:'シ',kun:'おも'},
    {k:'考',on:'コウ',kun:'かんが'},
    {k:'作',on:'サク',kun:'つく'},{k:'使',on:'シ',kun:'つか'},
    {k:'借',on:'シャク',kun:'か'},{k:'貸',on:'タイ',kun:'か'},
    {k:'住',on:'ジュウ',kun:'す'},{k:'知',on:'チ',kun:'し'},
    {k:'待',on:'タイ',kun:'ま'},{k:'持',on:'ジ',kun:'も'},
    {k:'教',on:'キョウ',kun:'おし'},
    {k:'習',on:'シュウ',kun:'なら'},
    {k:'強',on:'キョウ',kun:'つよ'},{k:'弱',on:'ジャク',kun:'よわ'},
    {k:'早',on:'ソウ',kun:'はや'},
    {k:'近',on:'キン',kun:'ちか'},{k:'遠',on:'エン',kun:'とお'}
  ],

  N3: [
    {k:'政',on:'セイ',kun:''},{k:'治',on:'ジ',kun:'おさ'},
    {k:'経',on:'ケイ',kun:''},{k:'済',on:'サイ',kun:''},
    {k:'法',on:'ホウ',kun:''},{k:'律',on:'リツ',kun:''},
    {k:'議',on:'ギ',kun:''},{k:'員',on:'イン',kun:''},
    {k:'選',on:'セン',kun:'えら'},{k:'挙',on:'キョ',kun:'あ'},
    {k:'権',on:'ケン',kun:''},{k:'義',on:'ギ',kun:''}
  ]
};

const levelsDiv = document.getElementById('levels');
const selectedKanji = new Set();

for (const lvl in LEVELS) {
  const div = document.createElement('div');
  div.className = 'level';

  const toggle = document.createElement('label');
  toggle.className = 'level-toggle';
  toggle.innerHTML = `<input type="checkbox"> ${lvl}`;

  const kanjiBox = document.createElement('div');
  kanjiBox.className = 'kanji-select';
  kanjiBox.style.display = 'none';

  toggle.querySelector('input').onchange = e => {
    kanjiBox.style.display = e.target.checked ? 'flex' : 'none';
  };

  LEVELS[lvl].forEach((k,i)=>{
    const label = document.createElement('label');
    label.innerHTML = `<input type="checkbox" data-key="${lvl}-${i}"><span>${k.k}</span>`;
    label.querySelector('input').onchange = e => {
      const key = e.target.dataset.key;
      e.target.checked ? selectedKanji.add(key) : selectedKanji.delete(key);
    };
    kanjiBox.appendChild(label);
  });

  div.appendChild(toggle);
  div.appendChild(kanjiBox);
  levelsDiv.appendChild(div);
}

let activeKanji = null;
const CHUNK_SIZE = 6;
let chunkIndex = 0;
let drillData = [];

function loadChunk() {
  const kanjiTray = document.getElementById('kanjiTray');
  const readingTray = document.getElementById('readingTray');
  kanjiTray.innerHTML = '';
  readingTray.innerHTML = '';
  activeKanji = null;

  const chunk = drillData.slice(chunkIndex, chunkIndex + CHUNK_SIZE);

  chunk.forEach(k => {
    const t = document.createElement('div');
    t.className = 'tile kanji-tile';
    t.textContent = k.k;
    t.onclick = () => {
      document.querySelectorAll('.kanji-tile').forEach(x=>x.classList.remove('selected'));
      t.classList.add('selected');
      activeKanji = { data: k, tile: t };
    };
    kanjiTray.appendChild(t);
  });

  [...chunk].sort(()=>Math.random()-0.5).forEach(k => {
    const t = document.createElement('div');
    t.className = 'tile reading-tile';
    t.textContent = [k.on,k.kun].filter(Boolean).join(', ');
    t.onclick = () => {
      if (!activeKanji || t.classList.contains('correct')) return;
      if (activeKanji.data.k === k.k) {
        t.classList.add('correct');
        t.textContent = '';
        const o = document.createElement('div');
        o.className = 'overlay-kanji';
        o.textContent = k.k;
        t.appendChild(o);
        activeKanji.tile.remove();
        activeKanji = null;

        const remaining = [...readingTray.children].some(rt => !rt.classList.contains('correct'));
        if (!remaining) {
          chunkIndex += CHUNK_SIZE;
          if (chunkIndex < drillData.length) {
            setTimeout(loadChunk, 600);
          }
        }
      }
    };
    readingTray.appendChild(t);
  });
}

function beginDrill(){
  if (!selectedKanji.size) return;

  drillData = [...selectedKanji].map(key => {
    const [lvl,i] = key.split('-');
    return LEVELS[lvl][i];
  });

  chunkIndex = 0;
  document.getElementById('startScreen').classList.add('hidden');
  document.getElementById('drillScreen').classList.remove('hidden');
  loadChunk();
}

document.getElementById('startDrill').onclick = beginDrill;
</script>
</body>
</html>
